---
title: 瞬時計劃刻
description: 瞬時計劃刻 - ScheduledUpdatesAreImmediate
toc: false
---

## 瞬時計劃刻

minecraft 為了在區塊裝飾時預先處理流體等方塊，故添加了本規則。(_**後續文章可能會使用 `ITT` 來代指它 \[即時方塊更新 Instant Tick updates]**_)

- `WorldGenHellLava` 地域岩漿
- `WorldGenLiquids` 基本流體
- `StructureNetherBridgePieces` 地域堡壘生成 (由於放置了 `FLOWING_LAVA` [流動岩漿])

```java{2} [World.java] line-numbers
public abstract class World implements IBlockAccess {
  public boolean scheduledUpdatesAreImmediate; // [!code focus]
}
```

## 如何關閉

`scheduledUpdatesAreImmediate` 會在 `immediateBlockTick` 函數內被修改。

```java{3,5} [World.java] line-numbers
public abstract class World implements IBlockAccess {
  public void immediateBlockTick(BlockPos pos, IBlockState state, Random random) {
    this.scheduledUpdatesAreImmediate = true;
    state.getBlock().updateTick(this, pos, state, random);
    this.scheduledUpdatesAreImmediate = false;
  }
}
```

而 `immediateBlockTick` 會被下面這些代碼呼叫。

::code-group
```java{1,4,18,23,24} [WorldGenHellLava.java] collapse height=150 line-numbers
public class WorldGenHellLava extends WorldGenerator { // [!code focus] 地獄岩漿生成
  // ...

  public boolean generate(World worldIn, Random rand, BlockPos position) { // [!code focus]
    if (worldIn.getBlockState(position.up()).getBlock() != Blocks.NETHERRACK) {
      return false;
    }
    // ...
    else {
      int i = 0;
      int j = 0;

      // ...

      if (!this.insideRock && i == 4 && j == 1 || i == 5) {
        IBlockState iblockstate = this.block.getDefaultState();
        worldIn.setBlockState(position, iblockstate, 2);
        worldIn.immediateBlockTick(position, iblockstate, rand); // [!code focus]
      }

      return true;
    }
  } // [!code focus]
} // [!code focus]
```

```java{1,4,22,28,29} [WorldGenLiquids.java] collapse height=150 line-numbers
public class WorldGenLiquids extends WorldGenerator { // [!code focus] 基本流體生成
  // ...

  public boolean generate(World worldIn, Random rand, BlockPos position) { // [!code focus]
    if (worldIn.getBlockState(position.up()).getBlock() != Blocks.STONE) {
      return false;
    }
    // ...
    else {
      IBlockState iblockstate = worldIn.getBlockState(position);
      if (iblockstate.getMaterial() != Material.AIR && iblockstate.getBlock() != Blocks.STONE) {
        return false;
      } else {
        int i = 0;
        int j = 0;

        // ...

        if (i == 3 && j == 1) {
          IBlockState iblockstate1 = this.block.getDefaultState();
          worldIn.setBlockState(position, iblockstate1, 2);
          worldIn.immediateBlockTick(position, iblockstate1, rand); // [!code focus]
        }

        return true;
      }
    }
  } // [!code focus]
} // [!code focus]
```

```java{1,2,5,19,23,24,25} [StructureNetherBridgePieces.java] collapse height=150 line-numbers
public class StructureNetherBridgePieces { // [!code focus] 地獄要塞生成
  public static class Entrance extends StructureNetherBridgePieces.Piece { // [!code focus]
    // ...

    public boolean addComponentParts(World worldIn, Random randomIn, StructureBoundingBox structureBoundingBoxIn) { // [!code focus]
      // ... 填充各式方塊

      this.fillWithBlocks(worldIn, structureBoundingBoxIn, 5, 5, 5, 7, 5, 7,
          Blocks.NETHER_BRICK.getDefaultState(), Blocks.NETHER_BRICK.getDefaultState(), false);
      this.fillWithBlocks(worldIn, structureBoundingBoxIn, 6, 1, 6, 6, 4, 6, Blocks.AIR.getDefaultState(),
          Blocks.AIR.getDefaultState(), false);
      this.setBlockState(worldIn, Blocks.NETHER_BRICK.getDefaultState(), 6, 0, 6, structureBoundingBoxIn);
      IBlockState iblockstate = Blocks.FLOWING_LAVA.getDefaultState();
      this.setBlockState(worldIn, iblockstate, 6, 5, 6, structureBoundingBoxIn);
      BlockPos blockpos = new BlockPos(this.getXWithOffset(6, 6), this.getYWithOffset(5),
          this.getZWithOffset(6, 6));

      if (structureBoundingBoxIn.isVecInside(blockpos)) {
        worldIn.immediateBlockTick(blockpos, iblockstate, randomIn); // [!code focus]
      }

      return true;
    } // [!code focus]
  } // [!code focus]
} // [!code focus]
```
::
